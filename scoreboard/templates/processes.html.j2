<!DOCTYPE html>
<html>
<head>
    <title>Processes Scoreboard</title>
    <link rel="stylesheet" type="text/css" href="static/main.css">
</head>
<body>
    <div style="margin: 4px 0 12px 0; color: #666;">
        Generated (MSK): {{ generated_msk }}
    </div>
    <table>
        <tr>
            <th rowspan="3">Name</th>
            <th rowspan="3" style="text-align: center;">V</th>
            {% for name in top_task_names %}
                {# For each task: seq (3 cols) + mpi (4 cols) + R (1 col) = 8 #}
                <th colspan="8" style="text-align: center;">{{ name }}</th>
            {% endfor %}
            <th rowspan="3">Total</th>
        </tr>
        <tr>
            {% for _ in top_task_names %}
                <th colspan="3" style="text-align: center;">seq</th>
                <th colspan="4" style="text-align: center;">mpi</th>
                <th rowspan="2" style="text-align: center;">R</th>
            {% endfor %}
        </tr>
        <tr>
            {% for _ in top_task_names %}
                {# seq sub-columns (no A/E) #}
                {% for letter in ('S', 'D', 'P') %}
                    <th style="text-align: center;">{{ letter }}</th>
                {% endfor %}
                {# mpi sub-columns (no E) #}
                {% for letter in ('S', 'A', 'D', 'P') %}
                    <th style="text-align: center;">{{ letter }}</th>
                {% endfor %}
            {% endfor %}
        </tr>
        {% for row in rows %}
        <tr>
            <td>{{ row.task }}</td>
            <td style="text-align: center;">{{ row.variant }}</td>
            {% set ns = namespace(idx=0, gi=0) %}
            {% for _ in top_task_names %}
                {# cells are stored as [mpi, seq] per task; render seq first #}
                {% set cell_mpi = row.groups[ns.idx] %}
                {% set cell_seq = row.groups[ns.idx + 1] %}
                {# seq: S, D, P #}
                <td style="text-align: center{% if cell_seq.solution_style %};{{ cell_seq.solution_style }}{% endif %}">{{ cell_seq.solution_points }}</td>
                <td style="text-align: center;">{{ cell_seq.deadline_points }}</td>
                <td style="text-align: center{% if cell_seq.plagiarised %}; background-color: pink{% endif %}">{{ cell_seq.plagiarism_points }}</td>
                {# mpi: S, A, D, P #}
                <td style="text-align: center{% if cell_mpi.solution_style %};{{ cell_mpi.solution_style }}{% endif %}">{{ cell_mpi.solution_points }}</td>
                <td style="text-align: center;background-color: lavender;">{{ cell_mpi.a_points if cell_mpi.a_points is defined else 0 }}</td>
                <td style="text-align: center;">{{ cell_mpi.deadline_points }}</td>
                <td style="text-align: center{% if cell_mpi.plagiarised %}; background-color: pink{% endif %}">{{ cell_mpi.plagiarism_points }}</td>
                {% set ns.idx = ns.idx + 2 %}
                {# R value for this task group #}
                <td style="text-align: center{% if (row.r_values[ns.gi] if row.r_values is defined else 0) > 0 %}; background-color: lightgreen{% endif %}">{{ row.r_values[ns.gi] if row.r_values is defined else 0 }}</td>
                {% set ns.gi = ns.gi + 1 %}
            {% endfor %}
            <td style="text-align: center;">{{ row.total }}</td>
        </tr>
        {% endfor %}
    </table>
</body>
</html>
